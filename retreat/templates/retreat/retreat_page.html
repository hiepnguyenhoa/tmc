{% extends "base.html" %}

{% load wagtailcore_tags %}
{% load wagtailimages_tags %}

{% block content %}

<!-- Debugging teacher_biography -->
<!--<script>-->
<!--    console.log("DEBUG: teacher_biography = {{ teacher_biography|default:"None" }}");-->
<!--</script>-->
<div class="retreat-page">
    <!-- Page Title -->
    <div class="page-title">
        <h1>{{ page.title }}</h1>
        {% if page.intro %}
        <p class="intro">{{ page.intro|safe }}</p>
        {% endif %}
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Left Panel -->
        <div class="left-panel">
            {% if teacher_biography %}
            <div class="teacher-biography">
                <div class="teacher-info">
                    {% if teacher_biography.image %}
                    <!-- Use wagtailimages_tags to render the image -->
                    {% image teacher_biography.image width-400 as teacher_image %}
                    <img class="teacher-portrait" src="{{ teacher_image.url }}" alt="{{ teacher_biography.name }}">
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <section>ðŸ‘¤ <a href="#">Teacher's Biography</a></section>
            <!-- Coordinators -->
            {% if coordinators %}
            <section class="coordinators">
                <strong>Coordinators</strong><br>
                {% for coordinator in coordinators %}
                {{ coordinator.name }}<br>
                {% if coordinator.phone_number %}
                Phone: {{ coordinator.phone_number }}<br>
                {% endif %}
                {% if coordinator.email %}
                Email: <a href="mailto:{{ coordinator.email }}">{{ coordinator.email }}</a>
                {% endif %}
                <br>
                {% endfor %}
            </section>
            {% endif %}

            <!-- Zoom Information -->
            {% if zoom_meeting %}
            <section class="zoom-info">
                <strong>Dhamma Talk Zoom Info</strong><br>
                <a href="{{ zoom_meeting.meeting_link }}" target="_blank">Meeting Link</a><br>
                Zoom ID: {{ zoom_meeting.meeting_id }} <br>
                Password: {{ zoom_meeting.meeting_password}}
            </section>
            {% endif %}
        </div>
    </div>

    <!-- Available Retreat Durations -->
    {% if page.grouped_retreat_durations %}
    <div class="available-retreats">
        <h2>Available Retreats</h2>
        {% for category, durations in page.grouped_retreat_durations.items %}
        <div class="retreat-category">
            <h3 class="category-name">
                {{ category }}
            </h3>
            <hr>
            <ul class="retreat-durations">
                {% for duration in durations %}
                <li class="retreat-duration">
                    {{ duration.start_date|date:"M j, Y" }} â€“ {{ duration.end_date|date:"M j, Y" }}
                    <div class="register-button">
                        <a href="{% url 'register_page' duration.id %}" class="btn btn-primary">Register</a>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>No available retreats found.</p>
    {% endif %}
</div>
{% endblock %}